<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆë²•ì†Œë…€ ì£¼ë¬¸ ê²Œì„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #fda4af 0%, #c084fc 50%, #93c5fd 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            width: 100%;
        }

        .game-box {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .icon {
            font-size: 64px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .spin {
            animation: spin 2s linear infinite;
        }

        h1 {
            color: #ec4899;
            font-size: 32px;
            margin-bottom: 20px;
        }

        h2 {
            color: #a855f7;
            font-size: 24px;
            margin-bottom: 20px;
        }

        h3 {
            color: #a855f7;
            font-size: 22px;
            margin-bottom: 20px;
        }

        p {
            color: #374151;
            font-size: 16px;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .hint {
            color: #6b7280;
            font-size: 14px;
            font-style: italic;
        }

        button {
            background: linear-gradient(135deg, #ec4899 0%, #a855f7 100%);
            color: white;
            border: none;
            padding: 18px 36px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin: 10px;
            -webkit-tap-highlight-color: transparent;
        }

        button:active {
            transform: scale(0.95);
        }

        .mic-button {
            background: linear-gradient(135deg, #ec4899 0%, #a855f7 100%);
            width: 140px;
            height: 140px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 30px auto;
            font-size: 60px;
            position: relative;
            padding: 0;
        }

        .mic-button.listening {
            animation: pulse 1s infinite;
        }

        .mic-button.listening::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(236, 72, 153, 0.3);
            animation: ping 1s infinite;
        }

        @keyframes ping {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.5); opacity: 0; }
        }

        .score-box {
            background: #fce7f3;
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
        }

        .score-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            font-size: 15px;
        }

        .score-item span:first-child {
            font-weight: bold;
        }

        .score-value {
            font-weight: bold;
            font-size: 16px;
        }

        .comment-box {
            background: #f3e8ff;
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
        }

        .rank {
            font-size: 64px;
            font-weight: bold;
            margin: 20px 0;
        }

        .rank.S { color: #ec4899; }
        .rank.A { color: #a855f7; }
        .rank.B { color: #3b82f6; }
        .rank.C { color: #10b981; }
        .rank.D { color: #6b7280; }

        .stars {
            font-size: 36px;
            margin: 10px 0;
        }

        .total-score {
            font-size: 42px;
            font-weight: bold;
            color: #a855f7;
            margin: 10px 0;
        }

        .spell-text {
            background: white;
            padding: 15px;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 16px;
            color: #374151;
            word-break: keep-all;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 480px) {
            .game-box {
                padding: 25px;
            }
            
            h1 {
                font-size: 26px;
            }
            
            h2 {
                font-size: 22px;
            }
            
            .mic-button {
                width: 120px;
                height: 120px;
                font-size: 50px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ì¸íŠ¸ë¡œ í™”ë©´ -->
        <div id="intro-screen" class="game-box">
            <div class="icon">âœ¨</div>
            <h1>âœ¨ ë§ˆë²•ì†Œë…€ ì£¼ë¬¸ ê²Œì„ âœ¨</h1>
            <p>ë§ˆì´í¬ì— ëŒ€ê³  ë§ˆë²•ì†Œë…€ìŠ¤ëŸ¬ìš´<br>ì£¼ë¬¸ì„ ì™¸ì³ë³´ì„¸ìš”!<br>AIê°€ ë‹¹ì‹ ì˜ ì£¼ë¬¸ì„ í‰ê°€í•´ë“œë¦½ë‹ˆë‹¤! ğŸ’–</p>
            <button id="start-btn">ì‹œì‘í•˜ê¸° ğŸŒŸ</button>
        </div>

        <!-- ì¤€ë¹„ í™”ë©´ -->
        <div id="ready-screen" class="game-box hidden">
            <h2 id="situation-title"></h2>
            <p id="situation-description"></p>
            <p class="hint" id="situation-hint"></p>
            <button class="mic-button" id="mic-button">ğŸ¤</button>
            <p>ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ë¬¸ì„ ì™¸ì¹˜ì„¸ìš”!</p>
        </div>

        <!-- ë“£ëŠ” ì¤‘ í™”ë©´ -->
        <div id="listening-screen" class="game-box hidden">
            <button class="mic-button listening" disabled>ğŸ¤</button>
            <h3>ë“£ê³  ìˆì–´ìš”... ğŸ¤</h3>
            <p>ë§ˆë²•ì†Œë…€ìŠ¤ëŸ¬ìš´ ì£¼ë¬¸ì„ ì™¸ì³ì£¼ì„¸ìš”!</p>
        </div>

        <!-- í‰ê°€ ì¤‘ í™”ë©´ -->
        <div id="evaluating-screen" class="game-box hidden">
            <div class="icon spin">âœ¨</div>
            <h3>ë§ˆë²•ì˜ í˜ì„ ì¸¡ì • ì¤‘... âœ¨</h3>
            <div class="spell-text" id="evaluating-spell"></div>
            <p>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</p>
        </div>

        <!-- ê²°ê³¼ í™”ë©´ -->
        <div id="result-screen" class="game-box hidden">
            <div class="stars" id="result-stars"></div>
            <div class="rank" id="result-rank"></div>
            <div class="total-score" id="result-total"></div>
            
            <div class="spell-text">
                <strong>ë‹¹ì‹ ì˜ ì£¼ë¬¸:</strong><br>"<span id="result-spell"></span>"
            </div>

            <div class="score-box">
                <div class="score-item">
                    <span>ğŸ’– ë§ˆë²•ì†Œë…€ìŠ¤ëŸ¬ì›€</span>
                    <span class="score-value" style="color: #ec4899;" id="score-magical"></span>
                </div>
                <div class="score-item">
                    <span>âœ¨ ì°½ì˜ì„±</span>
                    <span class="score-value" style="color: #a855f7;" id="score-creativity"></span>
                </div>
                <div class="score-item">
                    <span>ğŸ¯ ìƒí™© ì í•©ì„±</span>
                    <span class="score-value" style="color: #3b82f6;" id="score-situation"></span>
                </div>
                <div class="score-item">
                    <span>ğŸ”¥ ì—´ì •</span>
                    <span class="score-value" style="color: #ef4444;" id="score-passion"></span>
                </div>
            </div>

            <div class="comment-box">
                <p>ğŸ’– <strong>AIì˜ í•œë§ˆë””:</strong></p>
                <p id="result-comment"></p>
            </div>

            <button id="reset-btn">ë‹¤ì‹œ ë„ì „í•˜ê¸° ğŸŒŸ</button>
        </div>
    </div>

    <script>
        const situations = [
            {
                title: "ì–´ë‘ ì˜ ê´´ë¬¼ì´ ë‚˜íƒ€ë‚¬ë‹¤!",
                description: "ë§ˆë²•ì†Œë…€ë¡œ ë³€ì‹ í•˜ì—¬ ê´´ë¬¼ì„ ë¬¼ë¦¬ì¹  ì£¼ë¬¸ì„ ì™¸ì›Œë³´ì„¸ìš”!",
                hint: "ğŸ’¡ ì˜ˆ: ëŸ¬ë¸”ë¦¬ íí‹° ìŠ¤íŒŒí´ë§~ âœ¨"
            },
            {
                title: "ì¹œêµ¬ê°€ ìŠ¬í¼í•˜ê³  ìˆì–´ìš”",
                description: "ì¹œêµ¬ì—ê²Œ ìš©ê¸°ë¥¼ ì£¼ëŠ” ë§ˆë²• ì£¼ë¬¸ì„ ì™¸ì›Œë³´ì„¸ìš”!",
                hint: "ğŸ’¡ ì˜ˆ: ë°˜ì§ë°˜ì§ í•´í”¼ ìŠ¤ë§ˆì¼~ ğŸ’–"
            },
            {
                title: "ì‹œí—˜ì´ ë‹¤ê°€ì˜¨ë‹¤!",
                description: "ì§‘ì¤‘ë ¥ì„ ë†’ì´ëŠ” ë§ˆë²• ì£¼ë¬¸ì„ ì™¸ì›Œë³´ì„¸ìš”!",
                hint: "ğŸ’¡ ì˜ˆ: í‚¤ë¼í‚¤ë¼ ë¸Œë ˆì¸ íŒŒì›Œ~ â­"
            }
        ];

        let currentSituation;
        let recognition;
        let spellText = '';

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('start-btn').addEventListener('click', startGame);
            document.getElementById('mic-button').addEventListener('click', startListening);
            document.getElementById('reset-btn').addEventListener('click', resetGame);
        });

        function startGame() {
            currentSituation = situations[Math.floor(Math.random() * situations.length)];
            
            document.getElementById('situation-title').textContent = currentSituation.title;
            document.getElementById('situation-description').textContent = currentSituation.description;
            document.getElementById('situation-hint').textContent = currentSituation.hint;
            
            showScreen('ready-screen');
        }

        function startListening() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„±ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\nChrome ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”!');
                return;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            
            recognition.lang = 'ko-KR';
            recognition.continuous = false;
            recognition.interimResults = false;

            recognition.onstart = () => {
                showScreen('listening-screen');
            };

            recognition.onresult = (event) => {
                spellText = event.results[0][0].transcript;
                evaluateSpell(spellText);
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                
                let errorMsg = 'ìŒì„±ì¸ì‹ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\n';
                
                if (event.error === 'not-allowed') {
                    errorMsg += 'ë§ˆì´í¬ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”!\n\në¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ë§ˆì´í¬ ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                } else if (event.error === 'no-speech') {
                    errorMsg += 'ìŒì„±ì´ ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\në‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”!';
                } else {
                    errorMsg += 'ì˜¤ë¥˜: ' + event.error;
                }
                
                alert(errorMsg);
                showScreen('ready-screen');
            };

            try {
                recognition.start();
            } catch (e) {
                console.error('Recognition start error:', e);
                alert('ìŒì„±ì¸ì‹ì„ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\në‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”!');
            }
        }

        async function evaluateSpell(spell) {
            document.getElementById('evaluating-spell').textContent = `"${spell}"`;
            showScreen('evaluating-screen');

            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1000,
                        messages: [
                            {
                                role: 'user',
                                content: `ë‹¹ì‹ ì€ ë§ˆë²•ì†Œë…€ ì£¼ë¬¸ì„ í‰ê°€í•˜ëŠ” AIì…ë‹ˆë‹¤. ë‹¤ìŒ ì£¼ë¬¸ì„ í‰ê°€í•´ì£¼ì„¸ìš”:

ìƒí™©: ${currentSituation.title}
${currentSituation.description}

ìœ ì €ê°€ ì™¸ìš´ ì£¼ë¬¸: "${spell}"

ë‹¤ìŒ ê¸°ì¤€ìœ¼ë¡œ í‰ê°€í•˜ê³  JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•´ì£¼ì„¸ìš”:
1. ë§ˆë²•ì†Œë…€ìŠ¤ëŸ¬ì›€ (0-30ì ): ê·€ì—½ê³ , ë°˜ì§ì´ëŠ” ëŠë‚Œ, ì˜ì„±ì–´/ì˜íƒœì–´ ì‚¬ìš©
2. ì°½ì˜ì„± (0-30ì ): ë…ì°½ì ì´ê³  ì¬ë¯¸ìˆëŠ” í‘œí˜„
3. ìƒí™© ì í•©ì„± (0-30ì ): ì£¼ì–´ì§„ ìƒí™©ì— ì–´ìš¸ë¦¬ëŠ”ê°€
4. ì—´ì • (0-10ì ): ì£¼ë¬¸ì˜ ê¸¸ì´ì™€ ë…¸ë ¥

ì´ì ê³¼ ê° í•­ëª© ì ìˆ˜, ê·¸ë¦¬ê³  ì§§ì€ ì½”ë©˜íŠ¸ë¥¼ í¬í•¨í•´ì£¼ì„¸ìš”.

ì‘ë‹µ í˜•ì‹:
{
  "ë§ˆë²•ì†Œë…€ìŠ¤ëŸ¬ì›€": 25,
  "ì°½ì˜ì„±": 20,
  "ìƒí™©ì í•©ì„±": 22,
  "ì—´ì •": 8,
  "ì´ì ": 75,
  "ì½”ë©˜íŠ¸": "ë°˜ì§ë°˜ì§ ë¹›ë‚˜ëŠ” í‘œí˜„ì´ ì¢‹ì•˜ì–´ìš”!"
}`
                            }
                        ]
                    })
                });

                const data = await response.json();
                const resultText = data.content[0].text;
                
                const jsonMatch = resultText.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    const result = JSON.parse(jsonMatch[0]);
                    showResult(spell, result);
                } else {
                    throw new Error('í‰ê°€ ê²°ê³¼ë¥¼ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Evaluation error:', error);
                
                // í´ë°± í‰ê°€
                const fallbackScore = {
                    ë§ˆë²•ì†Œë…€ìŠ¤ëŸ¬ì›€: Math.floor(Math.random() * 15) + 15,
                    ì°½ì˜ì„±: Math.floor(Math.random() * 15) + 15,
                    ìƒí™©ì í•©ì„±: Math.floor(Math.random() * 15) + 15,
                    ì—´ì •: Math.floor(Math.random() * 5) + 5,
                    ì´ì : 0,
                    ì½”ë©˜íŠ¸: "í›Œë¥­í•œ ì£¼ë¬¸ì´ì—ˆì–´ìš”! âœ¨"
                };
                fallbackScore.ì´ì  = fallbackScore.ë§ˆë²•ì†Œë…€ìŠ¤ëŸ¬ì›€ + fallbackScore.ì°½ì˜ì„± + 
                                    fallbackScore.ìƒí™©ì í•©ì„± + fallbackScore.ì—´ì •;
                showResult(spell, fallbackScore);
            }
        }

        function getRank(score) {
            if (score >= 90) return { rank: 'S', stars: 5 };
            if (score >= 80) return { rank: 'A', stars: 4 };
            if (score >= 70) return { rank: 'B', stars: 3 };
            if (score >= 60) return { rank: 'C', stars: 2 };
            return { rank: 'D', stars: 1 };
        }

        function showResult(spell, evaluation) {
            const rankInfo = getRank(evaluation.ì´ì );
            
            document.getElementById('result-stars').textContent = 'â­'.repeat(rankInfo.stars);
            document.getElementById('result-rank').textContent = rankInfo.rank + ' ë“±ê¸‰';
            document.getElementById('result-rank').className = 'rank ' + rankInfo.rank;
            document.getElementById('result-total').textContent = evaluation.ì´ì  + 'ì ';
            document.getElementById('result-spell').textContent = spell;
            
            document.getElementById('score-magical').textContent = evaluation.ë§ˆë²•ì†Œë…€ìŠ¤ëŸ¬ì›€ + '/30';
            document.getElementById('score-creativity').textContent = evaluation.ì°½ì˜ì„± + '/30';
            document.getElementById('score-situation').textContent = evaluation.ìƒí™©ì í•©ì„± + '/30';
            document.getElementById('score-passion').textContent = evaluation.ì—´ì • + '/10';
            
            document.getElementById('result-comment').textContent = evaluation.ì½”ë©˜íŠ¸;
            
            showScreen('result-screen');
        }

        function showScreen(screenId) {
            const screens = ['intro-screen', 'ready-screen', 'listening-screen', 'evaluating-screen', 'result-screen'];
            screens.forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }

        function resetGame() {
            location.reload();
        }
    </script>
</body>
</html>